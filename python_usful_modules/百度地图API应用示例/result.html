<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
    <script type="text/javascript" src="http://api.map.baidu.com/api?v=2.0&ak=80ajy5bDFqQBnM5FPUtU7QAWcPVeB1Rq"></script>
    <script type="text/javascript" src="http://api.map.baidu.com/library/Heatmap/2.0/src/Heatmap_min.js"></script>
    <title>热力图功能示例</title>
    <style type="text/css">
		ul,li{list-style: none;margin:0;padding:0;float:left;}
		html{height:100%}
		body{height:100%;margin:0px;padding:0px;font-family:"微软雅黑";}
		#container{height:500px;width:100%;}
		#r-result{width:100%;}
    </style>	
</head>
<body>
	<div id="container"></div>
	<div id="r-result">
		<input type="button"  onclick="openHeatmap();" value="显示热力图"/><input type="button"  onclick="closeHeatmap();" value="关闭热力图"/>
	</div>
</body>
</html>
<script type="text/javascript">
    var map = new BMap.Map("container");          // 创建地图实例

    var point = new BMap.Point(114.0259736573215, 22.546053546205247);
    map.centerAndZoom(point, 13);             // 初始化地图，设置中心点坐标和地图级别
    map.enableScrollWheelZoom(); // 允许滚轮缩放
  
    var points =[{'lng': 113.93618767283063, 'lat': 22.578914782804706, 'count': 2.394190704334892},{'lng': 114.06273667006576, 'lat': 22.584048213801687, 'count': 1.2818923908820379},{'lng': 114.04314355988204, 'lat': 22.543367759381034, 'count': 15.021679236067449},{'lng': 113.95172679433024, 'lat': 22.64118177822337, 'count': 23.324088365619563},{'lng': 114.10128182260078, 'lat': 22.554366248641625, 'count': 16.20597050618383},{'lng': 114.06648854590806, 'lat': 22.454301203244174, 'count': -2.371707214076201},{'lng': 114.02548089035824, 'lat': 22.489971570857612, 'count': -2.0769602002531604},{'lng': 114.10948712867913, 'lat': 22.450473064946944, 'count': 13.85997606291513},{'lng': 114.06896763460038, 'lat': 22.64031285135256, 'count': -3.7474546036382783},{'lng': 114.05378273603027, 'lat': 22.532364921827, 'count': 7.037783113321574},{'lng': 114.05042148027236, 'lat': 22.528951857341408, 'count': 18.969512473067855},{'lng': 114.02467490567152, 'lat': 22.53795678887553, 'count': -1.6412526061076016},{'lng': 113.93718506206507, 'lat': 22.50320221751063, 'count': 17.544776739494317},{'lng': 114.0159410293435, 'lat': 22.62525025643549, 'count': -2.48152750755237},{'lng': 114.02834202081179, 'lat': 22.642901846271577, 'count': 11.278069511371783},{'lng': 114.04954643720916, 'lat': 22.643057071162286, 'count': -4.915198867343712},{'lng': 113.96703463467803, 'lat': 22.568693852350176, 'count': -2.9499914094251176},{'lng': 114.06526141341601, 'lat': 22.47939995804267, 'count': 17.72331562151016},{'lng': 114.01605843433828, 'lat': 22.51599796326301, 'count': 9.220884423117642},{'lng': 113.98488911417022, 'lat': 22.473270753303588, 'count': 16.436111818877706},{'lng': 113.9283130829254, 'lat': 22.59825404430782, 'count': -2.5186970929416175},{'lng': 113.95056559548999, 'lat': 22.482967246870135, 'count': -2.12369077455971},{'lng': 113.99147830863821, 'lat': 22.464709535751325, 'count': 3.979444857162232},{'lng': 113.99751349707454, 'lat': 22.500071111268806, 'count': 4.831022608578049},{'lng': 113.9961900113082, 'lat': 22.478775592042222, 'count': 0.36432770502448175},{'lng': 113.94812667950917, 'lat': 22.518695121332126, 'count': 14.087251567964003},{'lng': 113.99956189514492, 'lat': 22.535442710724123, 'count': 14.48814976303386},{'lng': 113.95353185412712, 'lat': 22.60157185254278, 'count': 10.574652245500094},{'lng': 114.09581545780676, 'lat': 22.55401356550745, 'count': 17.511248964669132},{'lng': 114.03316349666969, 'lat': 22.6136566304334, 'count': 21.505377576454066},{'lng': 113.97777038866668, 'lat': 22.563671034725328, 'count': 9.199449924419673},{'lng': 114.09639230349376, 'lat': 22.53268631941607, 'count': -3.0355204504203703},{'lng': 113.99400032807374, 'lat': 22.516122862515047, 'count': 18.154462900801235},{'lng': 113.95889076710138, 'lat': 22.56913661725788, 'count': 2.78771585928638},{'lng': 114.07102938980674, 'lat': 22.53888475124839, 'count': 15.536338955620657},{'lng': 113.98665146898875, 'lat': 22.55795713964173, 'count': 14.413827130327281},{'lng': 114.00245877650892, 'lat': 22.470205949855984, 'count': 18.619916246753306},{'lng': 114.11740393896467, 'lat': 22.582718644802426, 'count': -1.9427801430476563},{'lng': 114.05344807764091, 'lat': 22.529699310843597, 'count': 4.128253530416565},{'lng': 113.92830739708984, 'lat': 22.565419243944618, 'count': -4.910156687194292},{'lng': 114.077215637979, 'lat': 22.451303200583226, 'count': -3.6955136573188496},{'lng': 114.08582137497962, 'lat': 22.54301340244785, 'count': 7.368545979882201},{'lng': 114.07319589985089, 'lat': 22.571761160824412, 'count': 11.80690314184502},{'lng': 114.01364166747179, 'lat': 22.50384411005409, 'count': -4.822012829426464},{'lng': 114.11657933790862, 'lat': 22.488605723762436, 'count': 7.644542701834348},{'lng': 114.09005828259298, 'lat': 22.51001351278835, 'count': 6.58604931625791},{'lng': 113.98652153378042, 'lat': 22.584910549257124, 'count': 20.08274002428748},{'lng': 114.09633854454836, 'lat': 22.610242443786245, 'count': -0.8110453168876539},{'lng': 114.04323031404253, 'lat': 22.514996643782386, 'count': 9.812529315399175},{'lng': 114.10546138564018, 'lat': 22.58387189495274, 'count': 5.246805815580412},{'lng': 113.99786419630767, 'lat': 22.634175190333462, 'count': 24.45691856269282},{'lng': 113.93697907640268, 'lat': 22.54660457761206, 'count': -2.939509996834987},{'lng': 113.95390554035825, 'lat': 22.52642379691286, 'count': 20.213306821139774},{'lng': 113.9325189321008, 'lat': 22.53834969547719, 'count': 13.768424779524796},{'lng': 113.964976415248, 'lat': 22.577845372812767, 'count': 17.63360808379026},{'lng': 113.9951008828616, 'lat': 22.536768244672952, 'count': 6.366380784742212},{'lng': 113.98372739857057, 'lat': 22.557258382989442, 'count': 24.633870149147352},{'lng': 113.98239615522424, 'lat': 22.628271476562336, 'count': -0.9036944426414859},{'lng': 114.1044161472747, 'lat': 22.5573119863029, 'count': 11.915604092349898},{'lng': 114.12287241939761, 'lat': 22.474770011817803, 'count': 8.902095195174027},{'lng': 114.09946284376596, 'lat': 22.48164558125674, 'count': 22.454765909511025},{'lng': 113.94128214394317, 'lat': 22.47660495069175, 'count': 7.35782731837881},{'lng': 114.04485927833615, 'lat': 22.54731160750787, 'count': 5.912928079802004},{'lng': 113.9930426493521, 'lat': 22.6074080514178, 'count': 19.040821224548857},{'lng': 114.0342099374493, 'lat': 22.643499566216093, 'count': 8.024236472528203},{'lng': 113.97731463511214, 'lat': 22.606535558104536, 'count': 9.291451840873371},{'lng': 113.93470070320691, 'lat': 22.44742538676037, 'count': 7.682203477050228},{'lng': 113.96399139533082, 'lat': 22.610935861509, 'count': 19.054515476092},{'lng': 114.03154497344588, 'lat': 22.486998572068426, 'count': 7.08191243059178},{'lng': 113.96954185052081, 'lat': 22.593117700546507, 'count': 18.9260796681823},{'lng': 114.07698180893043, 'lat': 22.572505200255772, 'count': 20.68751669238272},{'lng': 114.05298323592255, 'lat': 22.632143503382, 'count': 13.629216660162001},{'lng': 114.07226877656433, 'lat': 22.53329021261194, 'count': 20.366563043006558},{'lng': 114.04846221793979, 'lat': 22.455284638276883, 'count': 14.707083193306904},{'lng': 113.98739092868153, 'lat': 22.63533869199944, 'count': 6.191334959559905},{'lng': 114.04959287144237, 'lat': 22.538241469557093, 'count': 9.31716089952735},{'lng': 113.96680519044483, 'lat': 22.53082074778567, 'count': -3.054309431459253},{'lng': 113.9805459502745, 'lat': 22.570074606979688, 'count': 4.0042366382477645},{'lng': 113.93466758441667, 'lat': 22.637973043887165, 'count': 13.171923498230946},{'lng': 114.02195587574126, 'lat': 22.578719804726312, 'count': 7.398050854909627},{'lng': 114.02762851184316, 'lat': 22.502836244362157, 'count': 14.262543905688911},{'lng': 113.97519097891444, 'lat': 22.590694220609375, 'count': 2.2510481899613186},{'lng': 113.98391898553928, 'lat': 22.528470256959146, 'count': 11.319083287539105},{'lng': 113.98877393200182, 'lat': 22.62802843888126, 'count': 10.178482119053147},{'lng': 114.08087711148592, 'lat': 22.518495889488953, 'count': 19.280573499480404},{'lng': 114.01370679467942, 'lat': 22.641161715832997, 'count': 16.096299033749577},{'lng': 114.05754662822841, 'lat': 22.64433622845612, 'count': -4.775857853946653},{'lng': 114.02072533970797, 'lat': 22.57894486440263, 'count': 0.2932913096682874},{'lng': 113.97273384236968, 'lat': 22.603399045919943, 'count': 5.625165435235646},{'lng': 113.98543825831531, 'lat': 22.599978132102457, 'count': 2.4597150911874817},{'lng': 114.10508086614148, 'lat': 22.4477429981931, 'count': 23.204758494516984},{'lng': 113.9766418455188, 'lat': 22.502146084830766, 'count': 17.490436358313957},{'lng': 114.09101198739842, 'lat': 22.446548606018567, 'count': -3.6246446446381753},{'lng': 114.03999730641934, 'lat': 22.51082068437263, 'count': 17.94792768954162},{'lng': 113.95260601875411, 'lat': 22.607933449484953, 'count': 4.570420558508804},{'lng': 114.01666415519895, 'lat': 22.478890551892835, 'count': 15.873709697036709},{'lng': 114.01047218645306, 'lat': 22.494411580053622, 'count': 17.451508967884163},{'lng': 114.00068360463749, 'lat': 22.58737765117539, 'count': -4.770129351767096},{'lng': 114.09226832655692, 'lat': 22.523750212172196, 'count': -1.910224975092679},{'lng': 113.97547858484151, 'lat': 22.488070545729812, 'count': 13.965137530585377}];
   
    if(!isSupportCanvas()){
    	alert('热力图目前只支持有canvas支持的浏览器,您所使用的浏览器不能使用热力图功能~')
    }
	//详细的参数,可以查看heatmap.js的文档 https://github.com/pa7/heatmap.js/blob/master/README.md
	//参数说明如下:
	/* visible 热力图是否显示,默认为true
     * opacity 热力的透明度,1-100
     * radius 势力图的每个点的半径大小   
     * gradient  {JSON} 热力图的渐变区间 . gradient如下所示
     *	{
			.2:'rgb(0, 255, 255)',
			.5:'rgb(0, 110, 255)',
			.8:'rgb(100, 0, 255)'
		}
		其中 key 表示插值的位置, 0~1. 
		    value 为颜色值. 
     */
	heatmapOverlay = new BMapLib.HeatmapOverlay({"radius":20});
	map.addOverlay(heatmapOverlay);
	heatmapOverlay.setDataSet({data:points,max:25});
	//是否显示热力图
    function openHeatmap(){
        heatmapOverlay.show();
    }
	function closeHeatmap(){
        heatmapOverlay.hide();
    }
	closeHeatmap();
    function setGradient(){
     	/*格式如下所示:
		{
	  		0:'rgb(102, 255, 0)',
	 	 	.5:'rgb(255, 170, 0)',
		  	1:'rgb(255, 0, 0)'
		}*/
     	var gradient = {};
     	var colors = document.querySelectorAll("input[type='color']");
     	colors = [].slice.call(colors,0);
     	colors.forEach(function(ele){
			gradient[ele.getAttribute("data-key")] = ele.value; 
     	});
        heatmapOverlay.setOptions({"gradient":gradient});
    }
	//判断浏览区是否支持canvas
    function isSupportCanvas(){
        var elem = document.createElement('canvas');
        return !!(elem.getContext && elem.getContext('2d'));
    }
</script>